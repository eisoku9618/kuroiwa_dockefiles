FROM eisoku9618/kuroiwa_dockefiles_for_jsk_ros_pkg:depend

ARG ROS_INSTALLDIR=/root/catkin_ws/indigo
ARG ROS_INSTALLDIR_SRC=${ROS_INSTALLDIR}/src/
ARG ROS_INSTALLDIR_PARENT_SRC=${ROS_INSTALLDIR}_parent/src/

# install necessary packages
RUN apt update \
&& apt install --no-install-recommends -y python-pip wget \
&& rm -rf /var/lib/apt/lists/*

# packages in /tmp/jsk.rosinstall will be downloaded and compiled
COPY jsk.rosinstall /tmp/jsk.rosinstall
RUN mkdir -p ${ROS_INSTALLDIR_SRC} \
&& wstool init ${ROS_INSTALLDIR_SRC} /tmp/jsk.rosinstall -j4

# download non-ros packages
RUN mkdir -p ${ROS_INSTALLDIR_PARENT_SRC} \
&& wstool init ${ROS_INSTALLDIR_PARENT_SRC} \
&& apt update \
# && ${ROS_INSTALLDIR_SRC}/jsk-ros-pkg/jsk_roseus/setup_upstream.sh -w ${ROS_INSTALLDIR_PARENT_SRC}/../ \
&& ${ROS_INSTALLDIR_SRC}/rtm-ros-robotics/rtmros_common/setup_upstream.sh -w ${ROS_INSTALLDIR_PARENT_SRC}/../ \
&& rm -rf /var/lib/apt/lists/*

# build non-ros packages and then build ros packages (chain)
SHELL ["/bin/bash", "-c"]
RUN source /opt/ros/indigo/setup.bash \
&& cd ${ROS_INSTALLDIR_PARENT_SRC}/../ \
&& catkin build \
&& source ${ROS_INSTALLDIR_PARENT_SRC}/../devel/setup.bash \
&& cd ${ROS_INSTALLDIR_SRC}/../ \
&& catkin build \
&& echo "source '/root/catkin_ws/indigo/devel/setup.bash'" >> /root/.bashrc

CMD ["bash"]
